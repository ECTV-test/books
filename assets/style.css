
    :root{
      --bg:#f6f7fb;
      --card:#ffffff;
      --text:#121826;
      --muted:#667085;
      --line:#e6e8ef;
      --primary:#1e88e5;
      --primary2:#2aa7ff;
      --shadow:0 10px 28px rgba(16,24,40,.10);
      --radius:18px;
      --readerBg:#efeff3;
      --underline: rgba(18,24,38,.35);

      /* highlight theme defaults (blue) */
      --hlWord: rgba(42,167,255,.26);

      --fontSize: 22px;
      --lineHeight: 1.9;

      --safeBottom: env(safe-area-inset-bottom);
    }

    [data-theme="night"]{
      --bg:#0b1220;
      --card:#0f1a2f;
      --text:#e8ecf5;
      --muted:#a8b3c7;
      --line:rgba(255,255,255,.10);
      --shadow:0 10px 28px rgba(0,0,0,.45);
      --readerBg:#0b1220;
      --underline: rgba(232,236,245,.28);
      --hlWord: rgba(42,167,255,.22);
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      background:var(--bg);
      color:var(--text);
    }
    a{color:inherit;text-decoration:none}
    button, select{font:inherit}
    .wrap{max-width:1120px;margin:0 auto;padding:24px 18px 86px}

    .topbar{
      display:flex;align-items:center;justify-content:space-between;gap:12px;
      padding:10px 0 18px;
    }
    .brand{
      display:flex;align-items:center;gap:12px;
      font-weight:800;letter-spacing:.2px;
      min-width:0;
    }
    .pill{
      font-size:12px;color:var(--muted);
      border:1px solid var(--line);
      padding:6px 10px;border-radius:999px;background:rgba(255,255,255,.35);
      white-space:nowrap;
    }
    [data-theme="night"] .pill{background:rgba(255,255,255,.04)}
    .navbtn{
      display:inline-flex;align-items:center;gap:8px;
      border:1px solid var(--line);
      background:var(--card);
      padding:10px 12px;border-radius:12px;
      box-shadow:0 2px 10px rgba(16,24,40,.06);
      cursor:pointer;
      font-weight:800;
      white-space:nowrap;
    }
    .navbtn:active{transform:translateY(1px)}
    .brandTitle{
      min-width:0;
      overflow:hidden;
      text-overflow:ellipsis;
      white-space:nowrap;
      max-width:48vw;
    }

    .sectionRow{
      display:flex;align-items:center;justify-content:space-between;gap:10px;margin:10px 0 16px;
    }
    .sectionTitle{font-size:20px;font-weight:900}
    .linkBtn{
      color:var(--primary);
      border:none;background:transparent;
      padding:8px 10px;border-radius:999px;
      cursor:pointer;
      font-weight:800;
      white-space:nowrap;
    }
    .linkBtn:hover{background:rgba(30,136,229,.08)}

    .grid{
      display:grid;
      grid-template-columns:repeat(6, minmax(0,1fr));
      gap:16px;
    }
    @media (max-width: 1100px){ .grid{grid-template-columns:repeat(3, minmax(0,1fr))} }
    @media (max-width: 640px){
      .grid{grid-template-columns:repeat(2, minmax(0,1fr))}
      .wrap{padding-bottom:110px}
      .brandTitle{max-width:44vw}
    }

    .card{
      background:var(--card);
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      overflow:hidden;
      cursor:pointer;
      transition:transform .12s ease;
      min-height:220px;
    }
    .card:hover{transform:translateY(-2px)}
    .cover{
      width:100%;
      aspect-ratio: 1 / 1.05;
      background:linear-gradient(145deg, #f4c9a9, #f7efe7);
      position:relative;
    }
    .cover img{width:100%;height:100%;object-fit:cover;display:block}
    .badgeTop{
      position:absolute;left:12px;top:12px;
      font-size:12px;color:var(--muted);
      background:rgba(255,255,255,.78);
      border:1px solid rgba(0,0,0,.06);
      padding:6px 10px;border-radius:999px;
      backdrop-filter: blur(8px);
      max-width: calc(100% - 24px);
      overflow:hidden;
      text-overflow:ellipsis;
      white-space:nowrap;
    }
    [data-theme="night"] .badgeTop{
      background:rgba(15,26,47,.72);
      border-color:rgba(255,255,255,.10);
    }
    .cardBody{padding:12px 12px 14px}
    .small{font-size:12px;color:var(--muted);margin:0 0 6px}
    .title{font-size:15px;font-weight:900;margin:0;line-height:1.25}
    .metaLine{
      display:flex;gap:10px;flex-wrap:wrap;margin-top:10px;
      color:var(--muted);font-size:12px;
    }
    .dot{width:6px;height:6px;border-radius:50%;background:#22c55e;display:inline-block;margin-right:6px}
    .metaItem{display:inline-flex;align-items:center;gap:6px}

    /* Details */
    .details{
      display:grid;
      grid-template-columns: 260px 1fr;
      gap:18px;
      align-items:start;
      margin-top:8px;
    }
    @media (max-width: 760px){ .details{grid-template-columns:1fr} }
    .bookPoster{
      border-radius:22px;
      overflow:hidden;
      border:1px solid var(--line);
      box-shadow:var(--shadow);
      background:var(--card);
    }
    .bookPoster img{width:100%;display:block}
    .panel{
      background:var(--card);
      border:1px solid var(--line);
      border-radius:22px;
      box-shadow:var(--shadow);
      padding:16px;
    }
    .kicker{font-size:12px;color:var(--muted);margin:0 0 6px}
    .bookName{font-size:26px;line-height:1.15;margin:0 0 10px;font-weight:950}
    .desc{color:var(--muted);line-height:1.55;margin:10px 0 14px}
    .infoRow{
      display:flex;gap:12px;flex-wrap:wrap;
      padding:10px 0 4px;color:var(--muted);font-size:13px
    }
    .infoRow b{color:var(--text)}
    .ctaRow{display:flex;gap:12px;flex-wrap:wrap;margin-top:10px}
    .btn{
      border:none;cursor:pointer;
      padding:12px 14px;border-radius:14px;
      font-weight:900;
      display:inline-flex;align-items:center;gap:10px;
      white-space:nowrap;
    }
    .btnPrimary{background:linear-gradient(135deg, var(--primary), var(--primary2));color:white}
    .btnGhost{background:transparent;border:1px solid var(--line);color:var(--text)}
    .btn:active{transform:translateY(1px)}

    /* Reader */
    .readerStage{
      background:var(--readerBg);
      min-height:calc(100vh - 0px);
      padding:14px 14px 118px;
    }
    .readerTop{
      max-width:980px;margin:0 auto 10px;
      display:flex;align-items:center;justify-content:space-between;gap:10px;
    }
    .readerTop .left{
      display:flex;align-items:center;gap:10px;
      min-width:0;
    }
    .readerTop .rtTitle{
      font-weight:950;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      max-width:60vw;
    }
    .paper{
      max-width:860px;margin:0 auto;
      padding:18px 22px 60px;
      background:transparent;
      color:var(--text);
    }
    .paperInner{
      background:transparent;
      border-radius:18px;
      padding:10px 6px;
    }
    .bookTitle{
      text-align:center;
      font-weight:950;
      font-size:44px;
      margin:6px 0 20px;
      letter-spacing:.2px;
      font-family: ui-serif, Georgia, "Times New Roman", Times, serif;
    }
    @media (max-width: 640px){
      .bookTitle{font-size:36px}
      .paper{padding:14px 10px 60px}
    }
    .para{
      font-family: ui-serif, Georgia, "Times New Roman", Times, serif;
      font-size: var(--fontSize);
      line-height: var(--lineHeight);
      margin: 0 0 18px;
    }
    .w{
      display:inline-block;
      padding:0 2px 2px;
      border-bottom: 2px solid var(--underline);
      user-select:none;
      border-radius:8px;
      cursor:pointer; /* теперь перевод по клику */
    }
    .w.space{border-bottom-color:transparent;padding:0;cursor:default}
    .w.active{
      background: var(--hlWord);
      border-bottom-color: transparent;
    }

    /* Bottom player */
    .playerBar{
      position:fixed;left:0;right:0;bottom:0;
      background:rgba(255,255,255,.75);
      backdrop-filter: blur(10px);
      border-top:1px solid var(--line);
      padding:10px 14px calc(10px + var(--safeBottom));
      z-index:50;
    }
    [data-theme="night"] .playerBar{background:rgba(15,26,47,.70)}
    .playerInner{
      max-width:980px;margin:0 auto;
      display:grid;
      grid-template-columns: 1fr auto;
      gap:12px;
      align-items:center;
    }
    @media (max-width: 520px){
      .playerInner{grid-template-columns:1fr}
      .controls{justify-content:space-between}
    }
    .progTop{display:flex;align-items:center;justify-content:space-between;gap:10px}
    .progTitle{font-weight:950;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:60vw}
    .progMeta{color:var(--muted);font-size:12px;white-space:nowrap}
    .bar{
      height:10px;border-radius:999px;
      background:rgba(0,0,0,.08);
      overflow:hidden;
      margin-top:8px;
    }
    [data-theme="night"] .bar{background:rgba(255,255,255,.10)}
    .bar > div{
      height:100%;width:0%;
      background:linear-gradient(135deg, var(--primary), var(--primary2));
      border-radius:999px;
    }
    .controls{display:flex;gap:10px;align-items:center;justify-content:flex-end}
    .iconBtn{
      border:1px solid var(--line);
      background:var(--card);
      width:44px;height:44px;border-radius:14px;
      display:inline-flex;align-items:center;justify-content:center;
      cursor:pointer;
      box-shadow:0 2px 10px rgba(16,24,40,.06);
      font-weight:950;
    }
    .iconBtn:active{transform:translateY(1px)}
    .playBtn{
      width:52px;height:52px;border-radius:16px;
      border:none;cursor:pointer;color:white;
      background:linear-gradient(135deg, var(--primary), var(--primary2));
      font-weight:950;
      display:inline-flex;align-items:center;justify-content:center;
    }

    /* Popover */
    .popover{
      position:fixed;
      min-width:220px;
      max-width:340px;
      background:var(--card);
      border:1px solid var(--line);
      box-shadow:var(--shadow);
      border-radius:16px;
      padding:12px;
      z-index:60;
      display:none;
    }
    .popRow{display:flex;align-items:center;justify-content:space-between;gap:10px}
    .popWord{font-weight:950}
    .popTrans{color:var(--muted);margin-top:6px;line-height:1.35}
    .miniBtn{
      border:1px solid var(--line);
      background:transparent;
      padding:6px 10px;border-radius:12px;
      cursor:pointer;
      font-weight:900;
      color:var(--text);
      white-space:nowrap;
    }
    .loading{opacity:.8;font-style:italic}

    /* Settings */
    .settings{
      position:fixed;right:14px;top:70px;
      width:360px;
      background:var(--card);
      border:1px solid var(--line);
      box-shadow:var(--shadow);
      border-radius:18px;
      padding:12px;
      z-index:70;
      display:none;
    }
    @media (max-width: 640px){
      /* на телефоне настройки как bottom-sheet */
      .settings{
        left:14px; right:14px;
        top:auto; bottom: calc(84px + var(--safeBottom));
        width:auto;
      }
    }
    .setHead{
      display:flex;align-items:center;justify-content:space-between;gap:10px;
      padding:6px 4px 10px;
      border-bottom:1px solid var(--line);
      margin-bottom:10px;
    }
    .setTitle{font-weight:950}
    .row{
      display:flex;align-items:center;justify-content:space-between;gap:10px;
      padding:10px 4px;
    }
    .row small{color:var(--muted)}
    .seg{
      display:flex;gap:8px;align-items:center;
      border:1px solid var(--line);
      border-radius:14px;padding:6px;
      background:rgba(0,0,0,.02);
    }
    [data-theme="night"] .seg{background:rgba(255,255,255,.03)}
    .seg button{
      border:none;background:transparent;cursor:pointer;
      padding:8px 10px;border-radius:12px;font-weight:950;color:var(--text)
    }
    .seg button.active{background:rgba(30,136,229,.14)}
    .toggle{
      width:46px;height:28px;border-radius:999px;
      background:rgba(0,0,0,.12);
      position:relative;border:1px solid var(--line);cursor:pointer;
    }
    [data-theme="night"] .toggle{background:rgba(255,255,255,.12)}
    .knob{
      width:24px;height:24px;border-radius:50%;
      background:var(--card);
      position:absolute;top:1px;left:1px;
      transition:left .15s ease;
      border:1px solid var(--line);
    }
    .toggle.on{background:rgba(30,136,229,.25)}
    .toggle.on .knob{left:21px}
    .range{width:170px}
    @media (max-width: 640px){ .range{width:140px} }
    .hint{font-size:12px;color:var(--muted);padding:0 4px 8px}
    select{
      border:1px solid var(--line);
      background:var(--card);
      color:var(--text);
      border-radius:12px;
      padding:10px 12px;
      outline:none;
      min-width:170px;
      font-weight:900;
    }
  

/* --- Catalog additions --- */

:root{
  --bg: #ececf1;
  --card: #ffffff;
  --text: #0f172a;
  --muted: #64748b;
  --accent: #2d79ff;
  --shadow: 0 10px 30px rgba(2,6,23,.08);
}
body.dark{
  --bg: #0b1220;
  --card: rgba(255,255,255,.06);
  --text: #e5e7eb;
  --muted: #9ca3af;
  --accent: #7aa2ff;
  --shadow: 0 10px 30px rgba(0,0,0,.35);
}
body{ background: var(--bg); color: var(--text); }
a{ color: inherit; }

.catalog-wrap{ max-width: 1060px; margin: 0 auto; padding: 28px 18px 70px; }
.catalog-head{ display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom: 18px;}
.brand{ display:flex; align-items:center; gap:10px; font-weight: 700; }
.brand .dot{ width:26px; height:26px; border-radius: 8px; background: var(--accent); box-shadow: var(--shadow);}
.pill{ display:inline-flex; align-items:center; gap:8px; padding: 10px 12px; border-radius: 14px; background: var(--card); box-shadow: var(--shadow); border: 1px solid rgba(2,6,23,.06); }
body.dark .pill{ border-color: rgba(255,255,255,.08); }
.pill small{ color: var(--muted); font-weight:600; }

.grid{ display:grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 18px; }
.card{ background: var(--card); border-radius: 18px; box-shadow: var(--shadow); overflow:hidden; border: 1px solid rgba(2,6,23,.06); cursor:pointer; transition: transform .12s ease, box-shadow .12s ease; }
body.dark .card{ border-color: rgba(255,255,255,.08); }
.card:hover{ transform: translateY(-2px); box-shadow: 0 14px 40px rgba(2,6,23,.12); }
body.dark .card:hover{ box-shadow: 0 18px 45px rgba(0,0,0,.45); }
.cover{ width:100%; aspect-ratio: 4/3; object-fit: cover; display:block; }
.card-body{ padding: 12px 12px 14px; }
.card-title{ font-weight: 800; line-height:1.15; margin: 4px 0 6px; }
.card-meta{ display:flex; gap:10px; flex-wrap:wrap; color: var(--muted); font-weight:600; font-size: 12px; }
.badge{ display:inline-flex; align-items:center; gap:6px; }
.dot-green{ width:7px; height:7px; border-radius: 50%; background: #22c55e; display:inline-block; }
.top-actions{ display:flex; gap:10px; align-items:center; }
.iconbtn{ width:40px; height:40px; border-radius: 14px; background: var(--card); box-shadow: var(--shadow); border: 1px solid rgba(2,6,23,.06); display:grid; place-items:center; cursor:pointer; }
body.dark .iconbtn{ border-color: rgba(255,255,255,.08); }
.iconbtn:active{ transform: translateY(1px); }


/* --- Reader glue --- */
:root{ --fontScale: 1; }
.readerContent{ font-size: calc(20px * var(--fontScale)); line-height: 1.65; }
body.hideTr .tr{ display:none; }

body[data-hc="default"] .w.active,
body[data-hc="default"] .line.active .w{ background: rgba(59,130,246,.14); border-color: rgba(59,130,246,.22); }
body[data-hc="yellow"] .w.active,
body[data-hc="yellow"] .line.active .w{ background: rgba(250,204,21,.22); border-color: rgba(250,204,21,.35); }

.line{ margin: 0 0 16px; }
.line .tr{ margin-top: 6px; color: var(--muted); font-size: 0.92em; }

.gap{ height: 18px; }

.w{
  display:inline-block;
  padding: 0 2px;
  border-bottom: 2px solid rgba(15,23,42,.22);
  border-radius: 6px;
}
body.dark .w{ border-bottom-color: rgba(255,255,255,.18); }

.w.active{ border-bottom-color: transparent; }
.line.active .orig{ filter: saturate(1.02); }

.playerBar{
  position: fixed;
  left: 0; right: 0; bottom: 0;
  padding: 12px 16px;
  background: rgba(236,236,241,.88);
  backdrop-filter: blur(12px);
  border-top: 1px solid rgba(2,6,23,.08);
  display:flex;
  align-items:center;
  justify-content: space-between;
  gap: 16px;
}
body.dark .playerBar{
  background: rgba(11,18,32,.72);
  border-top-color: rgba(255,255,255,.08);
}
.playerLeft{ flex: 1; min-width: 220px; }
.playerTitle{ font-weight: 800; margin-bottom: 6px; }
.playerProg{ display:flex; align-items:center; gap: 10px; }
.playerProg input[type="range"]{ width: 100%; }
.playerPct{ font-weight: 700; color: var(--muted); min-width: 42px; text-align:right; }
.playerBtns{ display:flex; gap: 10px; }
.pbtn{ width: 46px; height: 46px; border-radius: 16px; border: 1px solid rgba(2,6,23,.10); background: var(--card); box-shadow: var(--shadow); cursor:pointer; }
body.dark .pbtn{ border-color: rgba(255,255,255,.10); }
.pbtn.primary{ background: var(--accent); color: white; border-color: transparent; }
.pbtn:active{ transform: translateY(1px); }
